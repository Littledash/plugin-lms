{"version":3,"sources":["../../src/lessons/lessonsCollection.ts"],"sourcesContent":["import { CollectionConfig, Field } from 'payload'\nimport { FieldsOverride } from '../types.js'\nimport { embeddedVideo } from '../fields/embeddedVideo.js'\nimport { isAdminOrAuthorOrEnrolledInCourseFieldLevel } from '../access/isAdminOrAuthorOrEnrolledInCourse.js'\nimport { videoProgression } from '../fields/videoProgression.js'\n/**\n * Props interface for configuring the lessons collection\n * @property coursesCollectionSlug - Slug for the courses collection (default: 'courses')\n * @property mediaCollectionSlug - Slug for the media collection (default: 'media')\n * @property quizzesCollectionSlug - Slug for the quizzes collection (default: 'quizzes')\n * @property overrides - Optional configuration overrides for fields and collection settings\n */\ntype Props = {\n  coursesCollectionSlug?: string\n  mediaCollectionSlug?: string\n  quizzesCollectionSlug?: string\n  categoriesCollectionSlug?: string\n  studentsCollectionSlug?: string\n  overrides?: { fields?: FieldsOverride } & Partial<Omit<CollectionConfig, 'fields'>>\n}\n\n/**\n * Creates a lessons collection configuration for Payload CMS\n * This collection manages individual lessons within courses, including content, media, and assessments\n *\n * @param props - Configuration properties for the lessons collection\n * @returns CollectionConfig object for lessons\n */\nexport const lessonsCollection: (props?: Props) => CollectionConfig<'lessons'> = (props) => {\n  const {\n    overrides,\n    mediaCollectionSlug = 'media',\n    coursesCollectionSlug = 'courses',\n    quizzesCollectionSlug = 'quizzes',\n    categoriesCollectionSlug = 'categories',\n    studentsCollectionSlug = 'users',\n  } = props || {}\n  const fieldsOverride = overrides?.fields\n\n  /**\n   * Default fields for the lessons collection\n   * Includes lesson content, media, progression control, and assessment relationships\n   */\n  const defaultFields: Field[] = [\n    {\n      name: 'title',\n      type: 'text',\n      required: true,\n      admin: {\n        description: 'The title of the lesson',\n      },\n    },\n    {\n      name: 'excerpt',\n      type: 'textarea',\n      admin: {\n        description: 'The excerpt of the lesson',\n      },\n    },\n    {\n      name: 'content',\n      type: 'richText',\n      admin: {\n        description: 'The content of the lesson',\n      },\n      access: {\n        read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n      },\n    },\n    {\n      name: 'authors',\n      type: 'relationship',\n      relationTo: studentsCollectionSlug,\n      hasMany: true,\n      admin: {\n        position: 'sidebar',\n        allowCreate: false,\n        description: 'The authors of the lesson',\n      },\n    },\n    {\n      name: 'featuredImage',\n      type: 'upload',\n      relationTo: mediaCollectionSlug,\n      admin: {\n        position: 'sidebar',\n        description: 'The featured image of the lesson',\n      },\n    },\n    {\n      type: 'tabs',\n      tabs: [\n        {\n          name: 'lessonSettings',\n          label: 'Lesson Settings',\n          description: 'Controls the look and feel of the lesson and optional content settings',\n          fields: [\n            {\n              name: 'lessonMaterials',\n              type: 'richText',\n              label: 'Lesson Materials',\n              admin: {\n                description: 'The materials of the lesson',\n              },\n              access: {\n                read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n              },\n            },\n            embeddedVideo({\n              mediaCollectionSlug,\n              overrides: {\n                name: 'lessonVideo',\n                access: {\n                  read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n                },\n                admin: {\n                  description: 'The below video is tied to Course progression',\n                },\n              },\n            }),\n            videoProgression({\n              overrides: {\n                admin: {\n                  condition: (data, { lessonVideo }) => Boolean(lessonVideo.embed),\n                },\n                access: {\n                  read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n                },\n              },\n            }),\n          ],\n        },\n        {\n          label: 'Access Settings',\n          name: 'accessSettings',\n          description: 'Controls the timing and way lessons can be accessed.',\n          fields: [\n            {\n              name: 'lessonReleaseSchedule',\n              type: 'select',\n              label: 'Progression Behavior',\n              options: [\n                { label: 'Immediately', value: 'immediately' },\n                { label: 'Enrollment', value: 'enrollment' },\n                { label: 'Specific Date', value: 'specificDate' },\n              ],\n              defaultValue: 'immediately',\n              admin: {\n                description: 'The progression behavior of the lesson',\n              },\n            },  \n            {\n              name: 'lessonRelaseDays',\n              type: 'number',\n              label: 'Day(s) after enrollment',\n              admin: {\n                description: 'The number of days after enrollment the lesson will be released',\n                condition: (data, { lessonReleaseSchedule }) => lessonReleaseSchedule === 'enrollment',\n              },\n            },\n            {\n              name: 'lessonReleaseDate',\n              type: 'date',\n              admin: {\n                description: 'The date the lesson will be released',\n                condition: (data, { lessonReleaseSchedule }) => lessonReleaseSchedule === 'specificDate',\n              },\n            },\n          ],\n        },\n      ],\n    },\n    {\n      name: 'categories',\n      type: 'relationship',\n      relationTo: categoriesCollectionSlug,\n      admin: {\n        position: 'sidebar',\n        allowCreate: false,\n        description: 'The categories that the lesson belongs to',\n      },\n    },\n    {\n      name: 'course',\n      type: 'relationship',\n      relationTo: coursesCollectionSlug,\n      hasMany: false,\n      admin: {\n        position: 'sidebar',\n        allowCreate: false,\n        description: 'The course that the lesson belongs to',\n      },\n    },\n    {\n      name: 'quizzes',\n      type: 'array',\n      admin: {\n        position: 'sidebar',\n        description: 'The quizzes that are part of the lesson with their order and timing',\n      },\n      fields: [\n        {\n          name: 'quiz',\n          type: 'join',\n          collection: quizzesCollectionSlug,\n          on: 'lesson',\n          required: true,\n        },\n        {\n          name: 'order',\n          type: 'number',\n          required: true,\n          admin: {\n            width: '50%',\n            description: 'The order of the quiz in the lesson',\n          },\n        },\n        {\n          name: 'isRequired',\n          type: 'checkbox',\n          defaultValue: true,\n          admin: {\n            width: '50%',\n            description: 'Whether this quiz is required to complete the lesson',\n          },\n        },\n        {\n          name: 'releaseSchedule',\n          type: 'select',\n          defaultValue: 'immediately',\n          options: [\n            { label: 'Immediately', value: 'immediately' },\n            { label: 'After Previous Quiz', value: 'afterPrevious' },\n            { label: 'Specific Date', value: 'specificDate' },\n          ],\n          admin: {\n            width: '50%',\n            description: 'When this quiz becomes available',\n          },\n        },\n        {\n          name: 'releaseDate',\n          type: 'date',\n          admin: {\n            width: '50%',\n            description: 'The date the quiz will be released',\n            condition: (_, siblingData) => siblingData?.releaseSchedule === 'specificDate',\n          },\n        },\n        {\n          name: 'prerequisiteQuizzes',\n          type: 'relationship',\n          relationTo: quizzesCollectionSlug,\n          hasMany: true,\n          admin: {\n            width: '50%',\n            description: 'Quizzes that must be completed before this one',\n            condition: (_, siblingData) => siblingData?.releaseSchedule === 'afterPrevious',\n          },\n        },\n      ],\n    },\n    \n  ]\n\n  // Apply field overrides if provided\n  const fields =\n    fieldsOverride && typeof fieldsOverride === 'function'\n      ? fieldsOverride({ defaultFields })\n      : defaultFields\n\n  /**\n   * Base configuration for the lessons collection\n   * Includes slug, access control, timestamps, and admin settings\n   */\n  const baseConfig: CollectionConfig = {\n    slug: 'lessons',\n    timestamps: true,\n    ...overrides,\n    admin: {\n      useAsTitle: 'title',\n      group: 'LMS',\n      ...overrides?.admin,\n    },\n    fields,\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["embeddedVideo","isAdminOrAuthorOrEnrolledInCourseFieldLevel","videoProgression","lessonsCollection","props","overrides","mediaCollectionSlug","coursesCollectionSlug","quizzesCollectionSlug","categoriesCollectionSlug","studentsCollectionSlug","fieldsOverride","fields","defaultFields","name","type","required","admin","description","access","read","relationTo","hasMany","position","allowCreate","tabs","label","condition","data","lessonVideo","Boolean","embed","options","value","defaultValue","lessonReleaseSchedule","collection","on","width","_","siblingData","releaseSchedule","baseConfig","slug","timestamps","useAsTitle","group"],"mappings":"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"}