{"version":3,"sources":["../../src/fields/pricesField.ts"],"sourcesContent":["import type { ArrayField } from 'payload'\n\nimport type { CurrenciesConfig } from '../types.js'\n\nimport { amountField } from './amountField.js'\nimport { currencyField } from './currencyField.js'\n\n/**\n * Props for the prices field configuration\n */\ntype Props = {\n  /**\n   * Use this to specify a path for the condition.\n   */\n  conditionalPath?: string\n  currenciesConfig: CurrenciesConfig\n  overrides?: Partial<ArrayField>\n}\n\n/**\n * Creates a field for managing multiple price points\n * @param props - Configuration overrides for the field\n * @returns A configured array field for prices\n */\nexport const pricesField: (props: Props) => ArrayField = ({ currenciesConfig, overrides }) => {\n  const minRows = 1\n  const maxRows = currenciesConfig.supportedCurrencies.length ?? 1\n\n  const defaultCurrency =\n    (currenciesConfig.defaultCurrency ?? currenciesConfig.supportedCurrencies.length === 1)\n      ? currenciesConfig.supportedCurrencies[0]?.code\n      : undefined\n\n  const defaultValue = [\n    {\n      amount: 0,\n      currency: defaultCurrency,\n    },\n  ]\n\n  const field: ArrayField = {\n    name: 'prices',\n    type: 'array',\n    maxRows,\n    minRows,\n    ...(defaultValue && { defaultValue }),\n    ...overrides,\n    admin: {\n      ...overrides?.admin,\n      components: {\n        RowLabel: {\n          clientProps: {\n            currenciesConfig,\n          },\n          path: '@littledash/plugin-lms/ui/PriceRowLabel#PriceRowLabel',\n        },\n        ...overrides?.admin?.components,\n      },\n      initCollapsed: true,\n      readOnly: maxRows === minRows,\n      description: 'The price points for this item',\n    },\n    fields: [amountField({ currenciesConfig }), currencyField({ currenciesConfig })],\n  }\n\n  return field\n}\n"],"names":["amountField","currencyField","pricesField","currenciesConfig","overrides","minRows","maxRows","supportedCurrencies","length","defaultCurrency","code","undefined","defaultValue","amount","currency","field","name","type","admin","components","RowLabel","clientProps","path","initCollapsed","readOnly","description","fields"],"mappings":"AAIA,SAASA,WAAW,QAAQ,mBAAkB;AAC9C,SAASC,aAAa,QAAQ,qBAAoB;AAclD;;;;CAIC,GACD,OAAO,MAAMC,cAA4C,CAAC,EAAEC,gBAAgB,EAAEC,SAAS,EAAE;IACvF,MAAMC,UAAU;IAChB,MAAMC,UAAUH,iBAAiBI,mBAAmB,CAACC,MAAM,IAAI;IAE/D,MAAMC,kBACJ,AAACN,iBAAiBM,eAAe,IAAIN,iBAAiBI,mBAAmB,CAACC,MAAM,KAAK,IACjFL,iBAAiBI,mBAAmB,CAAC,EAAE,EAAEG,OACzCC;IAEN,MAAMC,eAAe;QACnB;YACEC,QAAQ;YACRC,UAAUL;QACZ;KACD;IAED,MAAMM,QAAoB;QACxBC,MAAM;QACNC,MAAM;QACNX;QACAD;QACA,GAAIO,gBAAgB;YAAEA;QAAa,CAAC;QACpC,GAAGR,SAAS;QACZc,OAAO;YACL,GAAGd,WAAWc,KAAK;YACnBC,YAAY;gBACVC,UAAU;oBACRC,aAAa;wBACXlB;oBACF;oBACAmB,MAAM;gBACR;gBACA,GAAGlB,WAAWc,OAAOC,UAAU;YACjC;YACAI,eAAe;YACfC,UAAUlB,YAAYD;YACtBoB,aAAa;QACf;QACAC,QAAQ;YAAC1B,YAAY;gBAAEG;YAAiB;YAAIF,cAAc;gBAAEE;YAAiB;SAAG;IAClF;IAEA,OAAOY;AACT,EAAC"}