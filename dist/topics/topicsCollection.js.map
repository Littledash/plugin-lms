{"version":3,"sources":["../../src/topics/topicsCollection.ts"],"sourcesContent":["import { CollectionConfig, Field } from 'payload'\nimport { FieldsOverride } from '../types.js'\nimport { embeddedVideo } from '../fields/embeddedVideo.js'\nimport { isAdminOrAuthor } from '../access/isAdminOrAuthor.js'\nimport { isAdminOrAuthorOrEnrolledInCourseFieldLevel } from '../access/isAdminOrAuthorOrEnrolledInCourse.js'\nimport { isAdminOrPublished } from '../access/isAdminOrPublished.js'\nimport { videoProgression } from '../fields/videoProgression.js'\n\n/**\n * Props interface for configuring the topics collection\n * @property coursesCollectionSlug - Slug for the courses collection (default: 'courses')\n * @property mediaCollectionSlug - Slug for the media collection (default: 'media')\n * @property quizzesCollectionSlug - Slug for the quizzes collection (default: 'quizzes')\n * @property lessonsCollectionSlug - Slug for the lessons collection (default: 'lessons')\n * @property overrides - Optional configuration overrides for fields and collection settings\n */\ntype Props = {\n  coursesCollectionSlug?: string\n  mediaCollectionSlug?: string\n  quizzesCollectionSlug?: string\n  lessonsCollectionSlug?: string\n  overrides?: { fields?: FieldsOverride } & Partial<Omit<CollectionConfig, 'fields'>>\n}\n\n/**\n * Creates a topics collection configuration for Payload CMS\n * This collection manages individual topics within lessons, including content, media, and assessments\n *\n * @param props - Configuration properties for the topics collection\n * @returns CollectionConfig object for topics\n */\nexport const topicsCollection: (props?: Props) => CollectionConfig<'topics'> = (props) => {\n  const {\n    overrides,\n    mediaCollectionSlug = 'media',\n    coursesCollectionSlug = 'courses',\n    quizzesCollectionSlug = 'quizzes',\n    lessonsCollectionSlug = 'lessons',\n  } = props || {}\n  const fieldsOverride = overrides?.fields\n\n  /**\n   * Default fields for the topics collection\n   * Includes topic content, media, video progression, and assessment relationships\n   */\n  const defaultFields: Field[] = [\n    {\n      name: 'title',\n      type: 'text',\n      required: true,\n      admin: {\n        description: 'The title of the topic',\n      },\n    },\n    {\n      name: 'excerpt',\n      type: 'text',\n      admin: {\n        description: 'The excerpt of the topic',\n      },\n    },\n    {\n      name: 'content',\n      type: 'richText',\n      label: 'Topic Content',\n      required: true,\n      admin: {\n        description: 'The content of the topic',\n      },\n      access: {\n        read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n      },\n    },\n    {\n      name: 'featuredImage',\n      type: 'upload',\n      relationTo: mediaCollectionSlug,\n      admin: {\n        position: 'sidebar',\n        description: 'The featured image of the topic',\n      },\n    },\n\n    embeddedVideo({\n      mediaCollectionSlug,\n      overrides: {\n        name: 'topicVideo',\n        access: {\n          read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n        },\n        admin: {\n          description: 'The video content for this topic',\n        },\n      },\n    }),\n    videoProgression({\n      overrides: {\n        admin: {\n          condition: (data, { topicVideo }) => Boolean(topicVideo.embed),\n        },\n        access: {\n          read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n        },\n      },\n    }),\n    {\n      name: 'topicMaterials',\n      type: 'richText',\n      label: 'Topic Materials',\n      admin: {\n        description: 'Additional materials and resources for the topic',\n      },\n      access: {\n        read: isAdminOrAuthorOrEnrolledInCourseFieldLevel,\n      },\n    },\n    {\n      name: 'course',\n      type: 'relationship',\n      relationTo: coursesCollectionSlug,\n      admin: {\n        position: 'sidebar',\n        allowCreate: false,\n        description: 'The course that the topic is associated with',\n      },\n    },\n    {\n      name: 'lesson',\n      type: 'relationship',\n      relationTo: lessonsCollectionSlug,\n      admin: {\n        position: 'sidebar',\n        allowCreate: false,\n        description: 'The lesson that the topic is associated with',\n      },\n    },\n  ]\n\n  // Apply field overrides if provided\n  const fields =\n    fieldsOverride && typeof fieldsOverride === 'function'\n      ? fieldsOverride({ defaultFields })\n      : defaultFields\n\n  /**\n   * Base configuration for the topics collection\n   * Includes slug, access control, timestamps, and admin settings\n   */\n  const baseConfig: CollectionConfig = {\n    slug: 'topics',\n    access: {\n      create: isAdminOrAuthor,\n      read: isAdminOrPublished,\n      update: isAdminOrAuthor,\n      delete: isAdminOrAuthor,\n    },\n    timestamps: true,\n    ...overrides,\n    admin: {\n      useAsTitle: 'title',\n      group: 'LMS',\n      ...overrides?.admin,\n    },\n    fields,\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["embeddedVideo","isAdminOrAuthor","isAdminOrAuthorOrEnrolledInCourseFieldLevel","isAdminOrPublished","videoProgression","topicsCollection","props","overrides","mediaCollectionSlug","coursesCollectionSlug","quizzesCollectionSlug","lessonsCollectionSlug","fieldsOverride","fields","defaultFields","name","type","required","admin","description","label","access","read","relationTo","position","condition","data","topicVideo","Boolean","embed","allowCreate","baseConfig","slug","create","update","delete","timestamps","useAsTitle","group"],"mappings":"AAEA,SAASA,aAAa,QAAQ,6BAA4B;AAC1D,SAASC,eAAe,QAAQ,+BAA8B;AAC9D,SAASC,2CAA2C,QAAQ,iDAAgD;AAC5G,SAASC,kBAAkB,QAAQ,kCAAiC;AACpE,SAASC,gBAAgB,QAAQ,gCAA+B;AAkBhE;;;;;;CAMC,GACD,OAAO,MAAMC,mBAAkE,CAACC;IAC9E,MAAM,EACJC,SAAS,EACTC,sBAAsB,OAAO,EAC7BC,wBAAwB,SAAS,EACjCC,wBAAwB,SAAS,EACjCC,wBAAwB,SAAS,EAClC,GAAGL,SAAS,CAAC;IACd,MAAMM,iBAAiBL,WAAWM;IAElC;;;GAGC,GACD,MAAMC,gBAAyB;QAC7B;YACEC,MAAM;YACNC,MAAM;YACNC,UAAU;YACVC,OAAO;gBACLC,aAAa;YACf;QACF;QACA;YACEJ,MAAM;YACNC,MAAM;YACNE,OAAO;gBACLC,aAAa;YACf;QACF;QACA;YACEJ,MAAM;YACNC,MAAM;YACNI,OAAO;YACPH,UAAU;YACVC,OAAO;gBACLC,aAAa;YACf;YACAE,QAAQ;gBACNC,MAAMpB;YACR;QACF;QACA;YACEa,MAAM;YACNC,MAAM;YACNO,YAAYf;YACZU,OAAO;gBACLM,UAAU;gBACVL,aAAa;YACf;QACF;QAEAnB,cAAc;YACZQ;YACAD,WAAW;gBACTQ,MAAM;gBACNM,QAAQ;oBACNC,MAAMpB;gBACR;gBACAgB,OAAO;oBACLC,aAAa;gBACf;YACF;QACF;QACAf,iBAAiB;YACfG,WAAW;gBACTW,OAAO;oBACLO,WAAW,CAACC,MAAM,EAAEC,UAAU,EAAE,GAAKC,QAAQD,WAAWE,KAAK;gBAC/D;gBACAR,QAAQ;oBACNC,MAAMpB;gBACR;YACF;QACF;QACA;YACEa,MAAM;YACNC,MAAM;YACNI,OAAO;YACPF,OAAO;gBACLC,aAAa;YACf;YACAE,QAAQ;gBACNC,MAAMpB;YACR;QACF;QACA;YACEa,MAAM;YACNC,MAAM;YACNO,YAAYd;YACZS,OAAO;gBACLM,UAAU;gBACVM,aAAa;gBACbX,aAAa;YACf;QACF;QACA;YACEJ,MAAM;YACNC,MAAM;YACNO,YAAYZ;YACZO,OAAO;gBACLM,UAAU;gBACVM,aAAa;gBACbX,aAAa;YACf;QACF;KACD;IAED,oCAAoC;IACpC,MAAMN,SACJD,kBAAkB,OAAOA,mBAAmB,aACxCA,eAAe;QAAEE;IAAc,KAC/BA;IAEN;;;GAGC,GACD,MAAMiB,aAA+B;QACnCC,MAAM;QACNX,QAAQ;YACNY,QAAQhC;YACRqB,MAAMnB;YACN+B,QAAQjC;YACRkC,QAAQlC;QACV;QACAmC,YAAY;QACZ,GAAG7B,SAAS;QACZW,OAAO;YACLmB,YAAY;YACZC,OAAO;YACP,GAAG/B,WAAWW,KAAK;QACrB;QACAL;IACF;IAEA,OAAO;QAAE,GAAGkB,UAAU;IAAC;AACzB,EAAC"}