{"version":3,"sources":["../../src/access/isMemberOfGroup.ts"],"sourcesContent":["import type { Access, TypedCollection, Where } from 'payload'\nimport { checkRole } from './checkRole.js'\n\nexport const isMemberOfGroup: Access = async ({ req, id }) => {\n  const { user } = req\n\n  if (!user) {\n    return false\n  }\n\n  if (checkRole(['admin'], user)) {\n    return true\n  }\n\n  if (id) {\n    const group = await req.payload.findByID({\n      collection: 'groups',\n      id,\n      depth: 1,\n    })\n\n    if (group) {\n      const userIds = group.users?.map(( member: TypedCollection['users']) => typeof member === 'object' ? member.id : member) || []\n      const leaderIds = group.leaders?.map((leader: TypedCollection['users']) => typeof leader === 'object' ? leader.id : leader) || []\n\n      if (userIds.includes(user.id) || leaderIds.includes(user.id)) {\n        return true\n      }\n    }\n  }\n\n  // A query to find groups a user is in\n  const query: Where = {\n    or: [\n      {\n        users: {\n          in: [user.id],\n        },\n      },\n      {\n        leaders: {\n          in: [user.id],\n        },\n      }\n    ]\n  }\n  return query\n  \n}\n"],"names":["checkRole","isMemberOfGroup","req","id","user","group","payload","findByID","collection","depth","userIds","users","map","member","leaderIds","leaders","leader","includes","query","or","in"],"mappings":"AACA,SAASA,SAAS,QAAQ,iBAAgB;AAE1C,OAAO,MAAMC,kBAA0B,OAAO,EAAEC,GAAG,EAAEC,EAAE,EAAE;IACvD,MAAM,EAAEC,IAAI,EAAE,GAAGF;IAEjB,IAAI,CAACE,MAAM;QACT,OAAO;IACT;IAEA,IAAIJ,UAAU;QAAC;KAAQ,EAAEI,OAAO;QAC9B,OAAO;IACT;IAEA,IAAID,IAAI;QACN,MAAME,QAAQ,MAAMH,IAAII,OAAO,CAACC,QAAQ,CAAC;YACvCC,YAAY;YACZL;YACAM,OAAO;QACT;QAEA,IAAIJ,OAAO;YACT,MAAMK,UAAUL,MAAMM,KAAK,EAAEC,IAAI,CAAEC,SAAqC,OAAOA,WAAW,WAAWA,OAAOV,EAAE,GAAGU,WAAW,EAAE;YAC9H,MAAMC,YAAYT,MAAMU,OAAO,EAAEH,IAAI,CAACI,SAAqC,OAAOA,WAAW,WAAWA,OAAOb,EAAE,GAAGa,WAAW,EAAE;YAEjI,IAAIN,QAAQO,QAAQ,CAACb,KAAKD,EAAE,KAAKW,UAAUG,QAAQ,CAACb,KAAKD,EAAE,GAAG;gBAC5D,OAAO;YACT;QACF;IACF;IAEA,sCAAsC;IACtC,MAAMe,QAAe;QACnBC,IAAI;YACF;gBACER,OAAO;oBACLS,IAAI;wBAAChB,KAAKD,EAAE;qBAAC;gBACf;YACF;YACA;gBACEY,SAAS;oBACPK,IAAI;wBAAChB,KAAKD,EAAE;qBAAC;gBACf;YACF;SACD;IACH;IACA,OAAOe;AAET,EAAC"}