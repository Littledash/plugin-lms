{"version":3,"sources":["../../src/plugin/index.ts"],"sourcesContent":["import type { Config } from 'payload'\n\nimport type { LMSPluginConfig, SanitizedLMSPluginConfig } from '../types.js'\nimport { addressesCollection } from '../addresses/addressesCollection.js'\nimport { coursesCollection } from '../courses/coursesCollection.js'\nimport { groupsCollection } from '../groups/groupsCollection.js'\nimport { lessonsCollection } from '../lessons/lessonsCollection.js'\nimport { quizzesCollection } from '../quizzes/quizzesCollection.js'\nimport { categoriesCollection } from '../categoires/categoriesCollection.js'\nimport { tagsCollection } from '../tags/tagsCollection.js'\nimport { certificatesCollection } from '../certificates/certificatesCollection.js'\nimport { questionsCollection } from '../questions/questionsCollection.js'\nimport { topicsCollection } from '../topics/topicsCollection.js'\nimport { defaultAddressFields } from '../fields/defaultAddressFields.js'\nimport { sanitizePluginConfig } from '../utilities/sanitizePluginConfig.js'\nimport { getCollectionSlugMap } from '../utilities/getCollectionSlugMap.js'\nimport { studentsCollection } from '../students/studentsCollection.js'\nimport { defaultStudentFields } from '../fields/defaultStudentFields.js'\n\nexport const lmsPlugin =\n  (pluginConfig?: LMSPluginConfig) =>\n  (incomingConfig: Config): Config => {\n    if (!pluginConfig) {\n      return incomingConfig\n    }\n\n    const sanitizedPluginConfig = sanitizePluginConfig({ pluginConfig })\n\n    /**\n     * Used to keep track of the slugs of collections in case they are overridden by the user.\n     */\n    const collectionSlugMap = getCollectionSlugMap({ sanitizedPluginConfig })\n\n    // Ensure collections exists\n    if (!incomingConfig.collections) {\n      incomingConfig.collections = []\n    }\n\n    const currenciesConfig: Required<SanitizedLMSPluginConfig['currencies']> =\n      sanitizedPluginConfig.currencies\n\n    let studentsFields\n\n    if (sanitizedPluginConfig.students) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.students === 'object'\n          ? sanitizedPluginConfig.students.studentsCollection\n          : undefined\n\n      studentsFields = sanitizedPluginConfig.students.studentsFields\n      console.log('studentsFields', studentsFields)\n\n      if (studentsFields) {\n        const students = studentsCollection({\n          studentsCollectionSlug: collectionSlugMap.students,\n          studentsFields: studentsFields({ defaultFields: defaultStudentFields() }),\n          overrides: collectionOverrides,\n        })\n\n        incomingConfig.collections.push(students)\n      }\n    }\n\n    let addressFields\n\n    if (sanitizedPluginConfig.addresses) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.addresses === 'object'\n          ? sanitizedPluginConfig.addresses.addressesCollection\n          : undefined\n\n      addressFields = sanitizedPluginConfig.addresses.addressFields\n\n      const supportedCountries = sanitizedPluginConfig.addresses.supportedCountries\n\n      const addresses = addressesCollection({\n        addressFields: addressFields({ defaultFields: defaultAddressFields() }),\n        studentsCollectionSlug: collectionSlugMap.students,\n        overrides: collectionOverrides,\n        supportedCountries,\n      })\n\n      incomingConfig.collections.push(addresses)\n    }\n\n    if (sanitizedPluginConfig.certificates) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.certificates === 'object'\n          ? sanitizedPluginConfig.certificates.certificatesCollection\n          : undefined\n\n      const certificates = certificatesCollection({\n        mediaCollectionSlug: collectionSlugMap.media,\n        studentsCollectionSlug: collectionSlugMap.students,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(certificates)\n    }\n\n    if (sanitizedPluginConfig.courses) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.courses === 'object'\n          ? sanitizedPluginConfig.courses.coursesCollection\n          : undefined\n\n      const courses = coursesCollection({\n        categoriesCollectionSlug: collectionSlugMap.categories,\n        certificatesCollectionSlug: collectionSlugMap.certificates,\n        currenciesConfig,\n        lessonsCollectionSlug: collectionSlugMap.lessons,\n        mediaCollectionSlug: collectionSlugMap.media,\n        studentsCollectionSlug: collectionSlugMap.students,\n        tagsCollectionSlug: collectionSlugMap.tags,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(courses)\n    }\n\n    if (sanitizedPluginConfig.groups) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.groups === 'object'\n          ? sanitizedPluginConfig.groups.groupsCollection\n          : undefined\n\n      const groups = groupsCollection({\n        coursesCollectionSlug: collectionSlugMap.courses,\n        usersCollectionSlug: collectionSlugMap.students,\n        certificatesCollectionSlug: collectionSlugMap.certificates,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(groups)\n    }\n\n    if (sanitizedPluginConfig.lessons) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.lessons === 'object'\n          ? sanitizedPluginConfig.lessons.lessonsCollection\n          : undefined\n\n      const lessons = lessonsCollection({\n        coursesCollectionSlug: collectionSlugMap.courses,\n        mediaCollectionSlug: collectionSlugMap.media,\n        quizzesCollectionSlug: collectionSlugMap.quizzes,\n        categoriesCollectionSlug: collectionSlugMap.categories,\n        studentsCollectionSlug: collectionSlugMap.students,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(lessons)\n    }\n\n    if (sanitizedPluginConfig.topics) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.topics === 'object'\n          ? sanitizedPluginConfig.topics.topicsCollection\n          : undefined\n\n      const topics = topicsCollection({\n        coursesCollectionSlug: collectionSlugMap.courses,\n        mediaCollectionSlug: collectionSlugMap.media,\n        quizzesCollectionSlug: collectionSlugMap.quizzes,\n        lessonsCollectionSlug: collectionSlugMap.lessons,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(topics)\n    }\n\n    if (sanitizedPluginConfig.quizzes) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.quizzes === 'object'\n          ? sanitizedPluginConfig.quizzes.quizzesCollection\n          : undefined\n\n      const quizzes = quizzesCollection({\n        mediaCollectionSlug: collectionSlugMap.media,\n        studentsCollectionSlug: collectionSlugMap.students,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(quizzes)\n    }\n\n    if (sanitizedPluginConfig.categories) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.categories === 'object'\n          ? sanitizedPluginConfig.categories.categoriesCollection\n          : undefined\n\n      const categories = categoriesCollection({\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(categories)\n    }\n\n    if (sanitizedPluginConfig.tags) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.tags === 'object'\n          ? sanitizedPluginConfig.tags.tagsCollection\n          : undefined\n\n      const tags = tagsCollection({\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(tags)\n    }\n\n    if (sanitizedPluginConfig.questions) {\n      const collectionOverrides =\n        typeof sanitizedPluginConfig.questions === 'object'\n          ? sanitizedPluginConfig.questions.questionsCollection\n          : undefined\n\n      const questions = questionsCollection({\n        studentsCollectionSlug: collectionSlugMap.students,\n        overrides: collectionOverrides,\n      })\n      incomingConfig.collections.push(questions)\n    }\n\n    return {\n      ...incomingConfig,\n    }\n  }\n"],"names":["addressesCollection","coursesCollection","groupsCollection","lessonsCollection","quizzesCollection","categoriesCollection","tagsCollection","certificatesCollection","questionsCollection","topicsCollection","defaultAddressFields","sanitizePluginConfig","getCollectionSlugMap","studentsCollection","defaultStudentFields","lmsPlugin","pluginConfig","incomingConfig","sanitizedPluginConfig","collectionSlugMap","collections","currenciesConfig","currencies","studentsFields","students","collectionOverrides","undefined","console","log","studentsCollectionSlug","defaultFields","overrides","push","addressFields","addresses","supportedCountries","certificates","mediaCollectionSlug","media","courses","categoriesCollectionSlug","categories","certificatesCollectionSlug","lessonsCollectionSlug","lessons","tagsCollectionSlug","tags","groups","coursesCollectionSlug","usersCollectionSlug","quizzesCollectionSlug","quizzes","topics","questions"],"mappings":"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"}