{"version":3,"sources":["../../src/utilities/isPreviousLessonCompleted.ts"],"sourcesContent":["import { TypedCollection, DefaultDocumentIDType } from \"payload\"\nimport { Progress, Lesson } from \"../providers/types.js\"\nimport { completedLesson } from \"./completedLesson.js\"\n\nexport const isPreviousLessonCompleted = (\n    progress: Progress,\n    course: Pick<TypedCollection['courses'], 'id' | 'title' | 'slug' | 'lessons'>,\n    lessonId: string,\n  ) => {\n    const lessonIndex = course.lessons?.findIndex(\n      (l: { lesson: DefaultDocumentIDType | { id: DefaultDocumentIDType } }) => \n        typeof l.lesson === 'object' && l.lesson !== null && l.lesson.id === lessonId,\n    )\n\n    \n    const previousLesson = lessonIndex !== undefined && lessonIndex > 0 ? course.lessons?.[lessonIndex - 1] : undefined\n    if (!previousLesson) return true // If there is no previous lesson, then the previous lesson is completed\n    \n    // Get the previous lesson object - it could be a full lesson object or just an ID\n    const previousLessonObj = typeof previousLesson.lesson === 'object' && previousLesson.lesson !== null \n      ? previousLesson.lesson \n      : null\n    \n    // If we have a full lesson object (with id property), use completedLesson to check completion including quizzes\n    if (previousLessonObj && 'id' in previousLessonObj) {\n      const completionStatus = completedLesson(progress, String(course.id), previousLessonObj as Lesson)\n      return completionStatus.isCompleted\n    }\n    \n    // Fallback: if we only have an ID, check basic lesson completion (without quiz check)\n    // This handles cases where the course wasn't fetched with depth\n    const previousLessonId = typeof previousLesson.lesson === 'object' && previousLesson.lesson !== null\n      ? previousLesson.lesson.id\n      : previousLesson.lesson\n    \n    const courseProgress = progress.find((p) => \n      (typeof p.course === 'object' ? p.course.id : p.course) === course.id\n    )\n    \n    if (!courseProgress) {\n      return false\n    }\n    \n    return (\n      courseProgress.completedLessons.find(\n        (l) => (typeof l.lesson === 'object' ? l.lesson.id : l.lesson) === previousLessonId,\n      ) !== undefined\n    )\n  }"],"names":["completedLesson","isPreviousLessonCompleted","progress","course","lessonId","lessonIndex","lessons","findIndex","l","lesson","id","previousLesson","undefined","previousLessonObj","completionStatus","String","isCompleted","previousLessonId","courseProgress","find","p","completedLessons"],"mappings":"AAEA,SAASA,eAAe,QAAQ,uBAAsB;AAEtD,OAAO,MAAMC,4BAA4B,CACrCC,UACAC,QACAC;IAEA,MAAMC,cAAcF,OAAOG,OAAO,EAAEC,UAClC,CAACC,IACC,OAAOA,EAAEC,MAAM,KAAK,YAAYD,EAAEC,MAAM,KAAK,QAAQD,EAAEC,MAAM,CAACC,EAAE,KAAKN;IAIzE,MAAMO,iBAAiBN,gBAAgBO,aAAaP,cAAc,IAAIF,OAAOG,OAAO,EAAE,CAACD,cAAc,EAAE,GAAGO;IAC1G,IAAI,CAACD,gBAAgB,OAAO,KAAK,wEAAwE;;IAEzG,kFAAkF;IAClF,MAAME,oBAAoB,OAAOF,eAAeF,MAAM,KAAK,YAAYE,eAAeF,MAAM,KAAK,OAC7FE,eAAeF,MAAM,GACrB;IAEJ,gHAAgH;IAChH,IAAII,qBAAqB,QAAQA,mBAAmB;QAClD,MAAMC,mBAAmBd,gBAAgBE,UAAUa,OAAOZ,OAAOO,EAAE,GAAGG;QACtE,OAAOC,iBAAiBE,WAAW;IACrC;IAEA,sFAAsF;IACtF,gEAAgE;IAChE,MAAMC,mBAAmB,OAAON,eAAeF,MAAM,KAAK,YAAYE,eAAeF,MAAM,KAAK,OAC5FE,eAAeF,MAAM,CAACC,EAAE,GACxBC,eAAeF,MAAM;IAEzB,MAAMS,iBAAiBhB,SAASiB,IAAI,CAAC,CAACC,IACpC,AAAC,CAAA,OAAOA,EAAEjB,MAAM,KAAK,WAAWiB,EAAEjB,MAAM,CAACO,EAAE,GAAGU,EAAEjB,MAAM,AAAD,MAAOA,OAAOO,EAAE;IAGvE,IAAI,CAACQ,gBAAgB;QACnB,OAAO;IACT;IAEA,OACEA,eAAeG,gBAAgB,CAACF,IAAI,CAClC,CAACX,IAAM,AAAC,CAAA,OAAOA,EAAEC,MAAM,KAAK,WAAWD,EAAEC,MAAM,CAACC,EAAE,GAAGF,EAAEC,MAAM,AAAD,MAAOQ,sBAC/DL;AAEV,EAAC"}