{"version":3,"sources":["../../src/utilities/completedQuiz.ts"],"sourcesContent":["import type { DefaultDocumentIDType } from 'payload'\nimport { CourseProgress, Progress, Quiz } from '../providers/types.js'\n\n/**\n * @fileoverview Utility functions for checking quiz completion and passing status\n * \n * This module provides functions to check if a quiz is completed and passed for a user.\n * A quiz is considered passed if the score is greater than or equal to the quiz's minimumScore.\n * \n * @example\n * ```typescript\n * import { completedQuiz, isQuizCompleted, isQuizPassed } from './completedQuiz'\n * \n * // Check quiz completion and passing status\n * const status = completedQuiz(progress, courseId, quizObject)\n * console.log(status) // { isCompleted: boolean, passed: boolean | null, score: number | null, completedAt: string | null }\n * \n * // Simple boolean check if quiz is completed\n * const isDone = isQuizCompleted(progress, courseId, quizId)\n * \n * // Simple boolean check if quiz is passed (requires quiz object for minimumScore)\n * const isPassed = isQuizPassed(progress, courseId, quizObject)\n * ```\n */\n\n/**\n * Checks if a quiz is completed for a specific course\n * @param courseProgress - The course progress object\n * @param quiz - The quiz object or quiz ID to check\n * @returns object with quiz ID if found, or null\n */\nconst findCompletedQuiz = (\n  courseProgress: CourseProgress,\n  quiz: Quiz | DefaultDocumentIDType\n): CourseProgress['completedQuizzes'][number] | null => {\n  const quizId = typeof quiz === 'object' ? quiz.id : quiz\n  \n  return courseProgress.completedQuizzes.find((cq) => \n    typeof cq.quiz === 'object' ? cq.quiz.id === quizId : cq.quiz === quizId\n  ) || null\n}\n\n/**\n * Checks if a quiz is completed for a specific course\n * @param progress - The user's progress across all courses\n * @param courseId - The ID of the course\n * @param quiz - The quiz object or quiz ID to check\n * @returns boolean indicating if the quiz is completed\n */\nexport const isQuizCompleted = (\n  progress: Progress,\n  courseId: DefaultDocumentIDType,\n  quiz: Quiz | DefaultDocumentIDType\n): boolean => {\n  const courseProgress = progress.find((p: CourseProgress) => \n    (typeof p.course === 'object' ? p.course.id : p.course) === courseId\n  )\n  \n  if (!courseProgress) {\n    return false\n  }\n  \n  return findCompletedQuiz(courseProgress, quiz) !== null\n}\n\n/**\n * Checks if a quiz is passed based on score and minimumScore\n * @param score - The user's score on the quiz\n * @param minimumScore - The minimum score required to pass the quiz\n * @returns boolean indicating if the quiz is passed\n */\nconst isScorePassing = (score: number, minimumScore?: number | null): boolean => {\n  // Default minimumScore is 100 if not specified\n  const requiredScore = minimumScore ?? 100\n  return score >= requiredScore\n}\n\n/**\n * Checks if a quiz is passed for a specific course\n * @param progress - The user's progress across all courses\n * @param courseId - The ID of the course\n * @param quiz - The quiz object (must include minimumScore) or quiz ID\n * @returns boolean indicating if the quiz is passed, or null if quiz object is not provided\n */\nexport const isQuizPassed = (\n  progress: Progress,\n  courseId: DefaultDocumentIDType,\n  quiz: Quiz | DefaultDocumentIDType\n): boolean | null => {\n  const courseProgress = progress.find((p: CourseProgress) => \n    (typeof p.course === 'object' ? p.course.id : p.course) === courseId\n  )\n  \n  if (!courseProgress) {\n    return false\n  }\n  \n  const completedQuizEntry = findCompletedQuiz(courseProgress, quiz)\n  \n  if (!completedQuizEntry) {\n    return false\n  }\n  \n  // Need quiz object to check minimumScore\n  if (typeof quiz !== 'object') {\n    return null // Can't determine without quiz object\n  }\n  \n  return isScorePassing(completedQuizEntry.score, quiz.minimumScore)\n}\n\n/**\n * Checks if a quiz is completed and passed, including completion details\n * @param progress - The user's progress across all courses\n * @param courseId - The ID of the course\n * @param quiz - The quiz object or quiz ID to check (quiz object recommended to check passing status)\n * @returns object with completion and passing status details\n */\nexport const completedQuiz = (\n  progress: Progress,\n  courseId: DefaultDocumentIDType,\n  quiz: Quiz | DefaultDocumentIDType,\n) => {\n  const courseProgress = progress.find((p: CourseProgress) => \n    (typeof p.course === 'object' ? p.course.id : p.course) === courseId\n  )\n  \n  if (!courseProgress) {\n    return {\n      isCompleted: false,\n      passed: null,\n      score: null,\n      completedAt: null\n    }\n  }\n  \n  const completedQuizEntry = findCompletedQuiz(courseProgress, quiz)\n  \n  if (!completedQuizEntry) {\n    return {\n      isCompleted: false,\n      passed: null,\n      score: null,\n      completedAt: null\n    }\n  }\n  \n  // Check if passed if we have the quiz object with minimumScore\n  const passed = typeof quiz === 'object' && quiz.minimumScore !== undefined\n    ? isScorePassing(completedQuizEntry.score, quiz.minimumScore)\n    : null\n  \n  return {\n    isCompleted: true,\n    passed,\n    score: completedQuizEntry.score,\n    completedAt: completedQuizEntry.completedAt\n  }\n}"],"names":["findCompletedQuiz","courseProgress","quiz","quizId","id","completedQuizzes","find","cq","isQuizCompleted","progress","courseId","p","course","isScorePassing","score","minimumScore","requiredScore","isQuizPassed","completedQuizEntry","completedQuiz","isCompleted","passed","completedAt","undefined"],"mappings":"AAGA;;;;;;;;;;;;;;;;;;;;CAoBC,GAED;;;;;CAKC,GACD,MAAMA,oBAAoB,CACxBC,gBACAC;IAEA,MAAMC,SAAS,OAAOD,SAAS,WAAWA,KAAKE,EAAE,GAAGF;IAEpD,OAAOD,eAAeI,gBAAgB,CAACC,IAAI,CAAC,CAACC,KAC3C,OAAOA,GAAGL,IAAI,KAAK,WAAWK,GAAGL,IAAI,CAACE,EAAE,KAAKD,SAASI,GAAGL,IAAI,KAAKC,WAC/D;AACP;AAEA;;;;;;CAMC,GACD,OAAO,MAAMK,kBAAkB,CAC7BC,UACAC,UACAR;IAEA,MAAMD,iBAAiBQ,SAASH,IAAI,CAAC,CAACK,IACpC,AAAC,CAAA,OAAOA,EAAEC,MAAM,KAAK,WAAWD,EAAEC,MAAM,CAACR,EAAE,GAAGO,EAAEC,MAAM,AAAD,MAAOF;IAG9D,IAAI,CAACT,gBAAgB;QACnB,OAAO;IACT;IAEA,OAAOD,kBAAkBC,gBAAgBC,UAAU;AACrD,EAAC;AAED;;;;;CAKC,GACD,MAAMW,iBAAiB,CAACC,OAAeC;IACrC,+CAA+C;IAC/C,MAAMC,gBAAgBD,gBAAgB;IACtC,OAAOD,SAASE;AAClB;AAEA;;;;;;CAMC,GACD,OAAO,MAAMC,eAAe,CAC1BR,UACAC,UACAR;IAEA,MAAMD,iBAAiBQ,SAASH,IAAI,CAAC,CAACK,IACpC,AAAC,CAAA,OAAOA,EAAEC,MAAM,KAAK,WAAWD,EAAEC,MAAM,CAACR,EAAE,GAAGO,EAAEC,MAAM,AAAD,MAAOF;IAG9D,IAAI,CAACT,gBAAgB;QACnB,OAAO;IACT;IAEA,MAAMiB,qBAAqBlB,kBAAkBC,gBAAgBC;IAE7D,IAAI,CAACgB,oBAAoB;QACvB,OAAO;IACT;IAEA,yCAAyC;IACzC,IAAI,OAAOhB,SAAS,UAAU;QAC5B,OAAO,KAAK,sCAAsC;;IACpD;IAEA,OAAOW,eAAeK,mBAAmBJ,KAAK,EAAEZ,KAAKa,YAAY;AACnE,EAAC;AAED;;;;;;CAMC,GACD,OAAO,MAAMI,gBAAgB,CAC3BV,UACAC,UACAR;IAEA,MAAMD,iBAAiBQ,SAASH,IAAI,CAAC,CAACK,IACpC,AAAC,CAAA,OAAOA,EAAEC,MAAM,KAAK,WAAWD,EAAEC,MAAM,CAACR,EAAE,GAAGO,EAAEC,MAAM,AAAD,MAAOF;IAG9D,IAAI,CAACT,gBAAgB;QACnB,OAAO;YACLmB,aAAa;YACbC,QAAQ;YACRP,OAAO;YACPQ,aAAa;QACf;IACF;IAEA,MAAMJ,qBAAqBlB,kBAAkBC,gBAAgBC;IAE7D,IAAI,CAACgB,oBAAoB;QACvB,OAAO;YACLE,aAAa;YACbC,QAAQ;YACRP,OAAO;YACPQ,aAAa;QACf;IACF;IAEA,+DAA+D;IAC/D,MAAMD,SAAS,OAAOnB,SAAS,YAAYA,KAAKa,YAAY,KAAKQ,YAC7DV,eAAeK,mBAAmBJ,KAAK,EAAEZ,KAAKa,YAAY,IAC1D;IAEJ,OAAO;QACLK,aAAa;QACbC;QACAP,OAAOI,mBAAmBJ,KAAK;QAC/BQ,aAAaJ,mBAAmBI,WAAW;IAC7C;AACF,EAAC"}