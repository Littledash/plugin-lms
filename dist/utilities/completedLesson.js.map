{"version":3,"sources":["../../src/utilities/completedLesson.ts"],"sourcesContent":["import { CourseProgress, Progress, Lesson, Quiz } from '../providers/types.js'\n\n/**\n * @fileoverview Utility functions for checking lesson completion status\n * \n * This module provides functions to check if a lesson is completed, including\n * both lesson completion and quiz completion requirements. Quizzes are considered\n * completed only if the user's score meets or exceeds the quiz's minimum score requirement.\n * \n * @example\n * ```typescript\n * import { completedLesson, lessonHasQuizzes, allQuizzesCompleted } from './completedLesson'\n * \n * // Check lesson completion including quiz completion\n * const status = completedLesson(progress, courseId, lessonObject)\n * console.log(status) // { isCompleted: boolean, hasQuizzes: boolean, allQuizzesCompleted: boolean, lessonCompleted: boolean }\n * \n * // Check if lesson has quizzes\n * const hasQuizzes = lessonHasQuizzes(lessonObject)\n * \n * // Check if all quizzes for a lesson are completed and passed (score >= minimumScore)\n * const allQuizzesDone = allQuizzesCompleted(courseProgress, lessonObject)\n * ```\n */\n\n/**\n * Checks if a lesson has any quizzes associated with it\n * @param lesson - The lesson object to check\n * @returns boolean indicating if the lesson has quizzes\n */\nexport const lessonHasQuizzes = (lesson: Lesson): boolean => {\n  return Boolean(lesson.quizzes && Array.isArray(lesson.quizzes) && lesson.quizzes.length > 0)\n}\n\n/**\n * Checks if a quiz score meets the minimum passing requirement\n * @param score - The user's score on the quiz\n * @param minimumScore - The minimum score required to pass the quiz\n * @returns boolean indicating if the quiz is passed\n */\nconst isScorePassing = (score: number, minimumScore?: number | null): boolean => {\n  // Default minimumScore is 100 if not specified\n  const requiredScore = minimumScore ?? 100\n  return score >= requiredScore\n}\n\n/**\n * Checks if all quizzes for a lesson are completed and passed (score meets minimum requirement)\n * @param courseProgress - The course progress object\n * @param lesson - The lesson object to check\n * @returns boolean indicating if all quizzes are completed and passed\n */\nexport const allQuizzesCompleted = (courseProgress: CourseProgress, lesson: Lesson): boolean => {\n  if (!lessonHasQuizzes(lesson)) {\n    return true // No quizzes means \"all quizzes completed\"\n  }\n\n  return lesson.quizzes.every((quiz: Quiz | string) => {\n    const quizId = typeof quiz === 'object' ? quiz.id : quiz\n    const minimumScore = typeof quiz === 'object' ? quiz.minimumScore : undefined\n    \n    // Find the completed quiz entry\n    const completedQuizEntry = courseProgress.completedQuizzes.find((cq) => \n      typeof cq.quiz === 'object' ? cq.quiz.id === quizId : cq.quiz === quizId\n    )\n    \n    // Quiz must be completed\n    if (!completedQuizEntry) {\n      return false\n    }\n    \n    // If we have the quiz object with minimumScore, check if the score meets the requirement\n    if (typeof quiz === 'object' && minimumScore !== undefined) {\n      return isScorePassing(completedQuizEntry.score, minimumScore)\n    }\n    \n    // If we don't have the quiz object, we can't verify minimum score\n    // Default to requiring 100% if minimumScore is not available\n    return isScorePassing(completedQuizEntry.score, 100)\n  })\n}\n\n/**\n * Checks if a lesson is completed, including both lesson completion and quiz completion\n * @param progress - The user's progress across all courses\n * @param courseId - The ID of the course\n * @param lesson - The lesson object to check\n * @returns object with completion status details\n */\nexport const completedLesson = (\n  progress: Progress,\n  courseId: string,\n  lesson: Lesson,\n) => {\n  const courseProgress = progress.find((p: CourseProgress) => \n    (typeof p.course === 'object' ? p.course.id : p.course) === courseId\n  )\n  \n  if (!courseProgress) {\n    return {\n      isCompleted: false,\n      hasQuizzes: false,\n      allQuizzesCompleted: false,\n      lessonCompleted: false\n    }\n  }\n  \n  const lessonCompleted = Boolean(\n    courseProgress.completedLessons.find((l) => \n      typeof l.lesson === 'object' ? l.lesson.id : l.lesson === lesson.id\n    )\n  )\n\n\n  const hasQuizzes = lessonHasQuizzes(lesson)\n  const allQuizzesCompletedForLesson = allQuizzesCompleted(courseProgress, lesson)\n  \n  // A lesson is fully completed if:\n  // 1. The lesson itself is marked as completed, AND\n  // 2. Either there are no quizzes, OR all quizzes are completed\n  const isCompleted = lessonCompleted && (!hasQuizzes || allQuizzesCompletedForLesson)\n  \n  return {\n    isCompleted,\n    hasQuizzes,\n    allQuizzesCompleted: allQuizzesCompletedForLesson,\n    lessonCompleted\n  }\n}"],"names":["lessonHasQuizzes","lesson","Boolean","quizzes","Array","isArray","length","isScorePassing","score","minimumScore","requiredScore","allQuizzesCompleted","courseProgress","every","quiz","quizId","id","undefined","completedQuizEntry","completedQuizzes","find","cq","completedLesson","progress","courseId","p","course","isCompleted","hasQuizzes","lessonCompleted","completedLessons","l","allQuizzesCompletedForLesson"],"mappings":"AAEA;;;;;;;;;;;;;;;;;;;;;CAqBC,GAED;;;;CAIC,GACD,OAAO,MAAMA,mBAAmB,CAACC;IAC/B,OAAOC,QAAQD,OAAOE,OAAO,IAAIC,MAAMC,OAAO,CAACJ,OAAOE,OAAO,KAAKF,OAAOE,OAAO,CAACG,MAAM,GAAG;AAC5F,EAAC;AAED;;;;;CAKC,GACD,MAAMC,iBAAiB,CAACC,OAAeC;IACrC,+CAA+C;IAC/C,MAAMC,gBAAgBD,gBAAgB;IACtC,OAAOD,SAASE;AAClB;AAEA;;;;;CAKC,GACD,OAAO,MAAMC,sBAAsB,CAACC,gBAAgCX;IAClE,IAAI,CAACD,iBAAiBC,SAAS;QAC7B,OAAO,KAAK,2CAA2C;;IACzD;IAEA,OAAOA,OAAOE,OAAO,CAACU,KAAK,CAAC,CAACC;QAC3B,MAAMC,SAAS,OAAOD,SAAS,WAAWA,KAAKE,EAAE,GAAGF;QACpD,MAAML,eAAe,OAAOK,SAAS,WAAWA,KAAKL,YAAY,GAAGQ;QAEpE,gCAAgC;QAChC,MAAMC,qBAAqBN,eAAeO,gBAAgB,CAACC,IAAI,CAAC,CAACC,KAC/D,OAAOA,GAAGP,IAAI,KAAK,WAAWO,GAAGP,IAAI,CAACE,EAAE,KAAKD,SAASM,GAAGP,IAAI,KAAKC;QAGpE,yBAAyB;QACzB,IAAI,CAACG,oBAAoB;YACvB,OAAO;QACT;QAEA,yFAAyF;QACzF,IAAI,OAAOJ,SAAS,YAAYL,iBAAiBQ,WAAW;YAC1D,OAAOV,eAAeW,mBAAmBV,KAAK,EAAEC;QAClD;QAEA,kEAAkE;QAClE,6DAA6D;QAC7D,OAAOF,eAAeW,mBAAmBV,KAAK,EAAE;IAClD;AACF,EAAC;AAED;;;;;;CAMC,GACD,OAAO,MAAMc,kBAAkB,CAC7BC,UACAC,UACAvB;IAEA,MAAMW,iBAAiBW,SAASH,IAAI,CAAC,CAACK,IACpC,AAAC,CAAA,OAAOA,EAAEC,MAAM,KAAK,WAAWD,EAAEC,MAAM,CAACV,EAAE,GAAGS,EAAEC,MAAM,AAAD,MAAOF;IAG9D,IAAI,CAACZ,gBAAgB;QACnB,OAAO;YACLe,aAAa;YACbC,YAAY;YACZjB,qBAAqB;YACrBkB,iBAAiB;QACnB;IACF;IAEA,MAAMA,kBAAkB3B,QACtBU,eAAekB,gBAAgB,CAACV,IAAI,CAAC,CAACW,IACpC,OAAOA,EAAE9B,MAAM,KAAK,WAAW8B,EAAE9B,MAAM,CAACe,EAAE,GAAGe,EAAE9B,MAAM,KAAKA,OAAOe,EAAE;IAKvE,MAAMY,aAAa5B,iBAAiBC;IACpC,MAAM+B,+BAA+BrB,oBAAoBC,gBAAgBX;IAEzE,kCAAkC;IAClC,mDAAmD;IACnD,+DAA+D;IAC/D,MAAM0B,cAAcE,mBAAoB,CAAA,CAACD,cAAcI,4BAA2B;IAElF,OAAO;QACLL;QACAC;QACAjB,qBAAqBqB;QACrBH;IACF;AACF,EAAC"}